"use strict";angular.module("angularApp",["ngAnimate","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",reloadOnSearch:!1}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("angularApp").controller("MainCtrl",["$scope","$http","$location",function(a,b,c){function d(a){h.seek((+a.start-+a.duration)/1e3),h.play()}function e(){void 0!==i&&clearTimeout(i),j=[]}function f(){if(void 0!==i&&clearTimeout(i),!m)return void(n=f);var a=j.shift();a?(d(a),i=setTimeout(function(){f()},3*a.duration)):h.pause()}function g(){if(m=k&&l,n&&m){var a=n;n=void 0,a()}}var h=SRG.PlayerManager.getPlayer("player");h.stop(),a.query=c.search().q,a.$watch("query",_.debounce(function(){a.$apply(function(){a.active=void 0,e(),h.stop(),c.search("q",a.query).replace(),b({url:"/search",params:{q:a.query}}).success(function(b,c,d,e){if(e.params.q===a.query){a.shows=b;var f=b[0].episodes[0];f&&f.matches&&a.activate(f)}})})}),200),a.seek=function(a){e(),d(a)};var i,j=[];h.addEventListener("paused",function(){e()});var k,l,m,n;h.addEventListener("media_seekable",function(){k=!0,g()}),h.addEventListener("loaded",function(){l=!0,k=!1,g()}),a.activate=function(c,d){(a.active!==c||d)&&(m=k=l=!1,h.stop(),h.load("urn:srf:ais:video:"+c.videoId)),a.active=c,a.transcript=[],setTimeout(function(){h.getUrn(function(b){b!=="urn:srf:ais:video:"+a.active.videoId&&a.$apply(function(){a.activate(a.active,!0)})})},1e3);var e=new RegExp(a.query.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),"gi");b.get("/"+c.transcript).success(function(b){a.transcript=d3.tsv.parse(b),a.transcript.forEach(function(a){a.matches=a.text.match(e),a.matchText=a.text.replace(e,"<mark>$&</mark>")}),j=a.transcript.filter(function(a){return a.matches}),f()})}}]),angular.module("angularApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);